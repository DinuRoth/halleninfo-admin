@page "/Dashboard"
@using Halleninfo

<PageTitle>My Dashboard</PageTitle>
<MudText Typo="Typo.h5">&nbsp;</MudText>
@if (SessionService.IsLoggedIn) {
    <MudGrid Spacing="7" Justify="Justify.Center">
        <MudItem xs="12" sm="5">
            <MudCard Class="p-4">
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Favoriten-Listen</MudText>
                </CardHeaderContent>
                <MudCardContent>
                @foreach (var type in Database.CurrentUser.FavoriteTypes) {
                    <MudChip OnClick="@(() => NavigationManager.NavigateTo ($"/List/{type.Name}"))" OnClose="@(() => SetUnfavorite(type))" Color="@Color.Primary" T="string">@type.Name</MudChip>
                }
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="5">
            <MudCard Class="p-4">
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Favoriten-Objekte</MudText>
                </CardHeaderContent>
                <MudCardContent>
                @foreach (var referenceID in Database.CurrentUser.FavoriteDBOs) {
                    var dbo = Database.Read (new ReferenceID (referenceID));
                        <MudChip OnClick="@(() => NavigationManager.NavigateTo($"{dbo.ViewURL}"))" OnClose="@(() => SetUnfavorite(dbo))" Color="@Color.Info" T="string">@(Database.GetLS (dbo.GetType ()) + ": " + dbo.Label)</MudChip>
                }
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="5">
            <MudCard Class="p-4">
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Zuletzt verwendet</MudText>
                </CardHeaderContent>
                @foreach (var dbo in Database.CurrentUser.LastViewedDBOs) {
                    <MudChip OnClick="@(() => NavigationManager.NavigateTo ($"{dbo.ViewURL}"))" OnClose="@(() => SetUnfavorite(dbo))" Color="@Color.Tertiary" T="string">@dbo.Label</MudChip>
                }
            </MudCard>
        </MudItem>
    </MudGrid>
}
 
@code {
    protected override void OnInitialized() {
        base.OnInitialized ();
    }

    private void SetUnfavorite(Type t) {
        Database.CurrentUser.FavoriteTypes.Remove (t);
        Database.CurrentUser.SaveOptions ();
    }

    private void SetUnfavorite(DBO dbo) {
        Database.CurrentUser.FavoriteDBOs.Remove (dbo.ReferenceID);
        Database.CurrentUser.SaveOptions ();
    }
}
